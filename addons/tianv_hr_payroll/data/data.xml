<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
        <record id="BASIC" model="hr.salary.rule.category">
            <field name="name">基本工资</field>
            <field name="code">BASIC</field>
        </record>
        <record id="BASIC_HOUR" model="hr.salary.rule.category">
            <field name="name">小时工资</field>
            <field name="code">BASIC_HOUR</field>
        </record>
        <record id="INSURANCE" model="hr.salary.rule.category">
            <field name="name">社保</field>
            <field name="code">INSURANCE</field>
        </record>
        <record id="ATTENDANCE" model="hr.salary.rule.category">
            <field name="name">考勤</field>
            <field name="code">ATTENDANCE</field>
        </record>
        <record id="BONUS" model="hr.salary.rule.category">
            <field name="name">奖金</field>
            <field name="code">BONUS</field>
        </record>
        <record id="RESULT" model="hr.salary.rule.category">
            <field name="name">综合</field>
            <field name="code">RESULT</field>
        </record>
        <record id="BALANCE" model="hr.salary.rule.category">
            <field name="name">平衡</field>
            <field name="code">BALANCE</field>
        </record>
        <record id="COMMISSION" model="hr.salary.rule.category">
            <field name="name">提成</field>
            <field name="code">COMMISSION</field>
        </record>

        <record id="tianv_payroll_rule_origin_salary" model="hr.salary.rule">
            <field name="name">初始工资</field>
            <field name="code">WAGE</field>
            <field name="sequence">10</field>
            <field name="category_id" ref="tianv_hr_payroll.BASIC"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = contract.wage</field>
        </record>
        <record id="tianv_payroll_rule_work_age_salary" model="hr.salary.rule">
            <field name="name">工龄工资</field>
            <field name="code">AGE_SALARY</field>
            <field name="sequence">12</field>
            <field name="category_id" ref="tianv_hr_payroll.BASIC"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = employee.compute_worked_month(payslip.date_to) * 10</field>
        </record>
        <record id="tianv_payroll_rule_work_job_salary" model="hr.salary.rule">
            <field name="name">岗位工资</field>
            <field name="code">JOB_SALARY</field>
            <field name="sequence">14</field>
            <field name="category_id" ref="tianv_hr_payroll.BASIC"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = contract.job.coefficient * 100</field>
        </record>
        <record id="tianv_payroll_rule_work_skill_salary" model="hr.salary.rule">
            <field name="name">技能工资</field>
            <field name="code">SKILL_SALARY</field>
            <field name="sequence">16</field>
            <field name="category_id" ref="tianv_hr_payroll.BASIC"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = contract.skill.coefficient * 100</field>
        </record>

        <record id="tianv_payroll_rule_work_daily" model="hr.salary.rule">
            <field name="name">小时工资</field>
            <field name="code">BASIC_HOUR</field>
            <field name="sequence">17</field>
            <field name="category_id" ref="tianv_hr_payroll.BASIC_HOUR"/>
            <field name="amount_select">code</field>
            <field name="appears_on_payslip" eval="False"/>
            <field name="amount_python_compute">
plan_hour = contract.get_attendance_plan_by_date(payslip.date_from, payslip.date_to).actual_hour
result = categories.BASIC / plan_hour
            </field>
        </record>

        <record id="tianv_payroll_rule_insurance_company" model="hr.salary.rule">
            <field name="name">单位交保</field>
            <field name="code">INSURANCE_COMPANY</field>
            <field name="sequence">18</field>
            <field name="category_id" ref="tianv_hr_payroll.INSURANCE"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = employee.get_insurance_record_by_date(payslip.date_from, payslip.date_to).company_total
            </field>
        </record>
        <record id="tianv_payroll_rule_insurance_employee" model="hr.salary.rule">
            <field name="name">个人交保</field>
            <field name="code">INSURANCE_EMPLOYEE</field>
            <field name="sequence">20</field>
            <field name="category_id" ref="tianv_hr_payroll.INSURANCE"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = employee.get_insurance_record_by_date(payslip.date_from, payslip.date_to).personal_total
            </field>
        </record>

        <record id="tianv_payroll_rule_attendance_late" model="hr.salary.rule">
            <field name="name">迟到扣款</field>
            <field name="code">ATTENDANCE_LATE</field>
            <field name="sequence">22</field>
            <field name="category_id" ref="tianv_hr_payroll.ATTENDANCE"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
allow_late_time = 3 # 允许迟到次数
late_time = contract.get_attendance_record_by_date(payslip.date_from, payslip.date_to).late_time
if late_time &lt;= allow_late_time:
    result = late_time * 0
else:
    result = (10 + categories.BASIC_HOUR * 2) * (late_time - allow_late_time) + 0 * allow_late_time
result = -result
            </field>
        </record>
        <record id="tianv_payroll_rule_attendance_early" model="hr.salary.rule">
            <field name="name">早退扣款</field>
            <field name="code">ATTENDANCE_EARLY</field>
            <field name="sequence">24</field>
            <field name="category_id" ref="tianv_hr_payroll.ATTENDANCE"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
allow_early_time = 3 # 允许早退次数
early_time = contract.get_attendance_record_by_date(payslip.date_from, payslip.date_to).early_time
if early_time &lt;= allow_early_time:
    result = early_time * 0
else:
    result = (10 + categories.BASIC_HOUR * 2) * (early_time - allow_early_time) + 0 * allow_early_time
result = -result
            </field>
        </record>
        <record id="tianv_payroll_rule_attendance_leave" model="hr.salary.rule">
            <field name="name">事假扣款</field>
            <field name="code">ATTENDANCE_LEAVE</field>
            <field name="sequence">26</field>
            <field name="category_id" ref="tianv_hr_payroll.ATTENDANCE"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
coefficient = 1.0 # 事假范围内系数
extra_coefficient = 1.5 # 事假超额系数
allow_hour = 16 # 允许事假小时数
actual_hour = contract.get_attendance_record_by_date(payslip.date_from, payslip.date_to).leave_time
if actual_hour &lt;= allow_hour:
    result = categories.BASIC_HOUR * actual_hour * coefficient
else:
    result = categories.BASIC_HOUR * ((actual_hour - allow_hour) * extra_coefficient + allow_hour * coefficient)
result = -result
            </field>
        </record>
        <record id="tianv_payroll_rule_attendance_sick" model="hr.salary.rule">
            <field name="name">病假扣款</field>
            <field name="code">ATTENDANCE_SICK</field>
            <field name="sequence">28</field>
            <field name="category_id" ref="tianv_hr_payroll.ATTENDANCE"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
coefficient = 0 # 病假范围内系数
extra_coefficient = 0.5 # 病假超额系数
allow_hour = 24 # 允许病假小时数
actual_hour = contract.get_attendance_record_by_date(payslip.date_from, payslip.date_to).sick_time
if actual_hour &lt;= allow_hour:
    result = categories.BASIC_HOUR * actual_hour * coefficient
else:
    result = categories.BASIC_HOUR * ((actual_hour - allow_hour) * extra_coefficient + allow_hour * coefficient)
result = -result
            </field>
        </record>
        <record id="tianv_payroll_rule_attendance_absent" model="hr.salary.rule">
            <field name="name">旷工扣款</field>
            <field name="code">ATTENDANCE_ABSENT</field>
            <field name="sequence">29</field>
            <field name="category_id" ref="tianv_hr_payroll.ATTENDANCE"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
coefficient = 3 # 旷工范围内系数
extra_coefficient = 5 # 旷工超额系数
allow_hour = 24 # 允许旷工小时数
actual_hour = contract.get_attendance_record_by_date(payslip.date_from, payslip.date_to).absent_time
if actual_hour &lt;= allow_hour:
    result = categories.BASIC_HOUR * actual_hour * coefficient
else:
    result = categories.BASIC_HOUR * ((actual_hour - allow_hour) * extra_coefficient + allow_hour * coefficient)
result = -result
            </field>
        </record>
        <record id="tianv_payroll_rule_attendance_no_work" model="hr.salary.rule">
            <field name="name">缺职扣款</field>
            <field name="code">ATTENDANCE_NO_WORK</field>
            <field name="sequence">30</field>
            <field name="category_id" ref="tianv_hr_payroll.ATTENDANCE"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
no_time = contract.get_attendance_record_by_date(payslip.date_from, payslip.date_to).no_time
if no_time:
    result = categories.BASIC_HOUR * no_time
else:
    result = 0.0
result = -result
            </field>
        </record>
        <record id="tianv_payroll_rule_attendance_time" model="hr.salary.rule">
            <field name="name">时间扣款</field>
            <field name="code">ATTENDANCE_TIME</field>
            <field name="sequence">31</field>
            <field name="category_id" ref="tianv_hr_payroll.ATTENDANCE"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
attendance_record = contract.get_attendance_record_by_date(payslip.date_from, payslip.date_to)
P = plan_hour = attendance_record.plan_hour
M = min_hour = attendance_record.min_hour
L = legal_hour = attendance_record.legal_hour
A = actual_hour = attendance_record.actual_hour + attendance_record.leave_time + attendance_record.sick_time

if A &lt; P &lt; M &lt; L:
    result = categories.BASIC_HOUR * (P - A) * 3
elif A &lt; M &lt; P &lt; L:
    result = categories.BASIC_HOUR * ((P - M) + (M - A) * 3)
elif A &lt; M &lt; L &lt; P:
    result = categories.BASIC_HOUR * ((L - M) + (M - A) * 3)
elif M &lt; A &lt; P &lt; L:
    result = categories.BASIC_HOUR * (P - A)
elif M &lt; A &lt; L &lt; P:
    result = categories.BASIC_HOUR * (L - A)
else:
    result = 0.0
result = -result
            </field>
        </record>

        <record id="tianv_payroll_rule_bonus_extra_work" model="hr.salary.rule">
            <field name="name">加班工资</field>
            <field name="code">EXTRA_WORK</field>
            <field name="sequence">35</field>
            <field name="category_id" ref="tianv_hr_payroll.BONUS"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
attendance_record = contract.get_attendance_record_by_date(payslip.date_from, payslip.date_to)
P = plan_hour = attendance_record.plan_hour
M = min_hour = attendance_record.min_hour
L = legal_hour = attendance_record.legal_hour
A = actual_hour = attendance_record.actual_hour

if P &lt; M &lt; A &lt; L:
    result = categories.BASIC_HOUR * (A - M)
elif M &lt; P &lt; A &lt; L:
    result = categories.BASIC_HOUR * (A - P)
elif P &lt; M &lt; L &lt; A:
    result = categories.BASIC_HOUR * ((L - M) + (A - L) * 3)
elif M &lt; P &lt; L &lt; A:
    result = categories.BASIC_HOUR * ((L - P) + (A - L) * 3)
elif M &lt; L &lt; P &lt; A:
    result = categories.BASIC_HOUR * (A - P) * 3
else:
    result = 0.0
            </field>
        </record>
        <record id="tianv_payroll_rule_bonus_allowance" model="hr.salary.rule">
            <field name="name">额外津贴</field>
            <field name="code">ALLOWANCE</field>
            <field name="sequence">36</field>
            <field name="category_id" ref="tianv_hr_payroll.BONUS"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = contract.allowance
            </field>
        </record>
        <record id="tianv_payroll_rule_bonus_full_work" model="hr.salary.rule">
            <field name="name">全勤奖金</field>
            <field name="code">FULL_WORK</field>
            <field name="sequence">37</field>
            <field name="category_id" ref="tianv_hr_payroll.BONUS"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
attendance_record = contract.get_attendance_record_by_date(payslip.date_from, payslip.date_to)
late_time = attendance_record.late_time
early_time = attendance_record.early_time
absent_time = attendance_record.absent_time
leave_time = attendance_record.leave_time
sick_time = attendance_record.sick_time
actual_hour = attendance_record.actual_hour
plan_hour = attendance_record.plan_hour
if not contract.attendance_rule.is_need_attendance:
    result = 0.0
elif late_time == 0 and early_time == 0 and absent_time == 0 and leave_time == 0 and sick_time == 0 and actual_hour >= plan_hour and attendance_record.no_time &lt;= 0.0:
    result = categories.BASIC_HOUR * 3 * 8
else:
    result = 0.0
            </field>
        </record>

        <record id="tianv_payroll_rule_service_commission" model="hr.salary.rule">
            <field name="name">服务提成</field>
            <field name="code">SERVICE_COMMISSION</field>
            <field name="sequence">38</field>
            <field name="category_id" ref="tianv_hr_payroll.COMMISSION"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.SERVICE_COMMISSION.amount if inputs.SERVICE_COMMISSION else 0.0</field>
        </record>
        <record id="tianv_payroll_rule_project_commission" model="hr.salary.rule">
            <field name="name">项目提成</field>
            <field name="code">PROJECT_COMMISSION</field>
            <field name="sequence">40</field>
            <field name="category_id" ref="tianv_hr_payroll.COMMISSION"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.PROJECT_COMMISSION.amount if inputs.PROJECT_COMMISSION else 0.0</field>
        </record>

        <record id="tianv_payroll_rule_balance" model="hr.salary.rule">
            <field name="name">平衡工资</field>
            <field name="code">BALANCE</field>
            <field name="sequence">47</field>
            <field name="category_id" ref="tianv_hr_payroll.BALANCE"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result = inputs.BALANCE.amount if inputs.BALANCE else 0.0</field>
        </record>

        <record id="tianv_payroll_rule_total_theory" model="hr.salary.rule">
            <field name="name">参考工资</field>
            <field name="code">THEORY_TOTAL</field>
            <field name="sequence">49</field>
            <field name="category_id" ref="tianv_hr_payroll.RESULT"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = categories.BASIC + categories.INSURANCE + categories.BONUS + EXTRA_WORK + categories.BALANCE + categories.COMMISSION + categories.BASIC_HOUR * 3 * 8
            </field>
        </record>
        <record id="tianv_payroll_rule_total_all" model="hr.salary.rule">
            <field name="name">工资支出</field>
            <field name="code">ALL_TOTAL</field>
            <field name="sequence">50</field>
            <field name="category_id" ref="tianv_hr_payroll.RESULT"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = categories.BASIC + categories.INSURANCE + categories.BONUS +  categories.ATTENDANCE + categories.BALANCE + categories.COMMISSION
            </field>
        </record>
        <record id="tianv_payroll_rule_total_actual" model="hr.salary.rule">
            <field name="name">实发工资</field>
            <field name="code">ACTUAL_TOTAL</field>
            <field name="sequence">52</field>
            <field name="category_id" ref="tianv_hr_payroll.RESULT"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = ALL_TOTAL - INSURANCE_COMPANY
            </field>
        </record>
        <record id="tianv_payroll_rule_total_cash" model="hr.salary.rule">
            <field name="name">现金工资</field>
            <field name="code">CASH_TOTAL</field>
            <field name="sequence">54</field>
            <field name="category_id" ref="tianv_hr_payroll.RESULT"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = ACTUAL_TOTAL - INSURANCE_EMPLOYEE
            </field>
        </record>

        <record id="tianv_payroll_rule_total_theory_trail" model="hr.salary.rule">
            <field name="name">参考工资</field>
            <field name="code">THEORY_TOTAL</field>
            <field name="sequence">49</field>
            <field name="category_id" ref="tianv_hr_payroll.RESULT"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = categories.BASIC + categories.BONUS + EXTRA_WORK + categories.BALANCE + categories.BASIC_HOUR * 3 * 8 + categories.COMMISSION
            </field>
        </record>
        <record id="tianv_payroll_rule_total_all_trail" model="hr.salary.rule">
            <field name="name">工资支出</field>
            <field name="code">ALL_TOTAL</field>
            <field name="sequence">50</field>
            <field name="category_id" ref="tianv_hr_payroll.RESULT"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = categories.BASIC + categories.BONUS +  categories.ATTENDANCE + categories.BALANCE + categories.COMMISSION
            </field>
        </record>
        <record id="tianv_payroll_rule_total_actual_trail" model="hr.salary.rule">
            <field name="name">实发工资</field>
            <field name="code">ACTUAL_TOTAL</field>
            <field name="sequence">52</field>
            <field name="category_id" ref="tianv_hr_payroll.RESULT"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = ALL_TOTAL
            </field>
        </record>
        <record id="tianv_payroll_rule_total_cash_trail" model="hr.salary.rule">
            <field name="name">现金工资</field>
            <field name="code">CASH_TOTAL</field>
            <field name="sequence">54</field>
            <field name="category_id" ref="tianv_hr_payroll.RESULT"/>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">
result = ACTUAL_TOTAL
            </field>
        </record>

        <record id="tianv_payroll_salary_structure_base" model="hr.payroll.structure">
            <field name="code">TIANV_BASE</field>
            <field name="name">基本工资</field>
            <field name="company_id" ref="base.main_company"/>
            <field name="rule_ids"
                   eval="[(6, 0, [ref('tianv_hr_payroll.tianv_payroll_rule_work_daily'), ref('tianv_hr_payroll.tianv_payroll_rule_work_skill_salary'), ref('tianv_hr_payroll.tianv_payroll_rule_origin_salary'), ref('tianv_hr_payroll.tianv_payroll_rule_work_age_salary'), ref('tianv_hr_payroll.tianv_payroll_rule_work_job_salary')])]"/>
            <field name="parent_id" eval="False"/>
        </record>
        <record id="tianv_payroll_salary_structure_attendance" model="hr.payroll.structure">
            <field name="code">TIANV_ATTENDANCE</field>
            <field name="name">考勤扣款</field>
            <field name="company_id" ref="base.main_company"/>
            <field name="rule_ids"
            eval="[(6, 0, [ref('tianv_hr_payroll.tianv_payroll_rule_attendance_no_work'), ref('tianv_hr_payroll.tianv_payroll_rule_attendance_absent'), ref('tianv_hr_payroll.tianv_payroll_rule_attendance_sick'), ref('tianv_hr_payroll.tianv_payroll_rule_attendance_leave'), ref('tianv_hr_payroll.tianv_payroll_rule_attendance_time'), ref('tianv_hr_payroll.tianv_payroll_rule_attendance_early'), ref('tianv_hr_payroll.tianv_payroll_rule_attendance_late')])]"/>
            <field name="parent_id" ref="tianv_payroll_salary_structure_base"/>
        </record>
        <record id="tianv_payroll_salary_structure_commission" model="hr.payroll.structure">
            <field name="code">TIANV_COMMISSION</field>
            <field name="name">提成工资</field>
            <field name="company_id" ref="base.main_company"/>
            <field name="rule_ids"
            eval="[(6, 0, [ref('tianv_hr_payroll.tianv_payroll_rule_service_commission'), ref('tianv_hr_payroll.tianv_payroll_rule_project_commission')])]"/>
            <field name="parent_id" ref="tianv_payroll_salary_structure_attendance"/>
        </record>
        <record id="tianv_payroll_salary_structure_bonus" model="hr.payroll.structure">
            <field name="code">TIANV_BONUS</field>
            <field name="name">额外奖金</field>
            <field name="company_id" ref="base.main_company"/>
            <field name="rule_ids"
            eval="[(6, 0, [ref('tianv_hr_payroll.tianv_payroll_rule_balance'), ref('tianv_hr_payroll.tianv_payroll_rule_bonus_allowance'), ref('tianv_hr_payroll.tianv_payroll_rule_bonus_full_work'), ref('tianv_hr_payroll.tianv_payroll_rule_bonus_extra_work')])]"/>
            <field name="parent_id" ref="tianv_payroll_salary_structure_commission"/>
        </record>
        <record id="tianv_payroll_salary_structure_insurance" model="hr.payroll.structure">
            <field name="code">TIANV_INSURANCE</field>
            <field name="name">社保缴费</field>
            <field name="company_id" ref="base.main_company"/>
            <field name="rule_ids"
                   eval="[(6, 0, [ref('tianv_hr_payroll.tianv_payroll_rule_insurance_company'), ref('tianv_hr_payroll.tianv_payroll_rule_insurance_employee')])]"/>
            <field name="parent_id" ref="tianv_payroll_salary_structure_bonus"/>
        </record>
        <record id="tianv_payroll_salary_structure_root" model="hr.payroll.structure">
            <field name="code">TIANV_SALARY</field>
            <field name="name">正式员工</field>
            <field name="company_id" ref="base.main_company"/>
            <field name="rule_ids"
                   eval="[(6,0,[ref('tianv_hr_payroll.tianv_payroll_rule_total_theory'), ref('tianv_hr_payroll.tianv_payroll_rule_total_cash'), ref('tianv_hr_payroll.tianv_payroll_rule_total_actual'), ref('tianv_hr_payroll.tianv_payroll_rule_total_all')])]"/>
            <field name="parent_id" ref="tianv_payroll_salary_structure_insurance"/>
        </record>
        <record id="tianv_payroll_salary_structure_trail" model="hr.payroll.structure">
            <field name="code">TIANV_TRAIL_SALARY</field>
            <field name="name">试用员工</field>
            <field name="company_id" ref="base.main_company"/>
            <field name="rule_ids"
                   eval="[(6,0,[ref('tianv_hr_payroll.tianv_payroll_rule_total_theory_trail'), ref('tianv_hr_payroll.tianv_payroll_rule_total_cash_trail'), ref('tianv_hr_payroll.tianv_payroll_rule_total_actual_trail'), ref('tianv_hr_payroll.tianv_payroll_rule_total_all_trail')])]"/>
            <field name="parent_id" ref="tianv_payroll_salary_structure_bonus"/>
        </record>
    </data>
</openerp>