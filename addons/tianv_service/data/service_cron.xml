<?xml version="1.0" encoding='UTF-8'?>
<openerp>
    <data>

        <record id="service_cron_email_template" model="email.template">
            <field name="name">Service expiration reminder</field>
            <field name="email_from">${(object.user_id.email or object.company_id.email or 'noreply@localhost')|safe}</field>
            <field name="subject">Service expiration reminder ${user.company_id.name}</field>
            <field name="email_to">${object.email|safe}</field>
            <field name="lang">${object.lang}</field>
            <field name="model_id" ref="base.model_res_users"/>
            <field name="auto_delete" eval="True"/>
            <field name="body_html"><![CDATA[
 ${object.name}您好,

% macro account_table(values):
<table cellspacing="1" border="1" cellpadding="4">
    <tr>
        <th>甲方</th>
        <th>服务</th>
        <th>日期</th>
        <th>预付单元</th>
        <th>合同</th>
    </tr>
    % for partner, accounts in values:
        % for account in accounts:
        <tr>
            <td>${partner.name}</td>
            <td><a href="${ctx["base_url"]}/#action=${ctx["action_id"]}&id=${account.id}&view_type=form">${account.name}</a></td>
            <td>${account.date_start} 至 ${account.date and account.date or '???'}</td>
            <td>
            % if account.quantity_max != 0.0:
                ${account.remaining_hours}/${account.quantity_max} 单位
            % endif
            </td>
            <td>${account.partner_id.phone or ''}, ${account.partner_id.email or ''}</td>
        </tr>
        % endfor
    % endfor
</table>
% endmacro 

% if "new" in ctx["data"]:
    <h2>以下的服务刚刚过期:</h2>
    ${account_table(ctx["data"]["new"].iteritems())}
% endif

% if "old" in ctx["data"]:
    <h2>以下的服务仍然没有处理:</h2>
    ${account_table(ctx["data"]["old"].iteritems())}
% endif

% if "future" in ctx["data"]:
    <h2>以下的服务将在一个月内过期:</h2>
    ${account_table(ctx["data"]["future"].iteritems())}
% endif

<p>
    你能通过以下目录查看这些信息:
</p>
<ul>
    <li>服务 / 服务</li>
</ul>
<p>
    谢谢,
</p>

<pre>
===========================================
深圳市天艺网络技术有限公司
ShenZhen Tianv Network Technology Co.,LTD
Tel:0086-755-8622 6905
Fax:0086-755-8622 6925
Web:http://www.tianv.com
Mail:tianv@tianv.com
===========================================
</pre>

            ]]></field>
        </record>

        <record model="ir.cron" id="service_cron">
            <field name="name">Service expiration reminder</field>
            <field name="interval_number">1</field>
            <field name="interval_type">work_days</field>
            <field name="numbercall">-1</field>
            <field name="doall" eval="False"/>
            <field name="model" eval="'tianv.service.service'"/>
            <field name="function" eval="'cron_computer_explore'"/>
            <field name="args" eval="'()'" />
        </record>

         <record id="invoice_reminder_email_template" model="email.template">
            <field name="name">Invoice reminder</field>
            <field name="email_from">${(object.user_id.email or object.company_id.email or 'noreply@localhost')|safe}</field>
            <field name="subject">Invoice reminder ${user.company_id.name}</field>
            <field name="email_to">${object.email|safe}</field>
            <field name="lang">${object.lang}</field>
            <field name="model_id" ref="base.model_res_users"/>
            <field name="auto_delete" eval="False"/>
            <field name="body_html"><![CDATA[
<p>
Client ${ctx['invoice'].partner_id.name}'s invoice ${ctx['invoice'].number} need process.
</p>
            ]]></field>
        </record>
    </data>
</openerp>
